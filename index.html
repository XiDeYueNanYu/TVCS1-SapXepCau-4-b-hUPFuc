<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>越南语-语法-排序练习</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding-bottom: 300px;
            background-color: #f7fbf3;
        }
        
        #gameContainer {
            min-height: calc(100vh - 150px);
        }
        
        #infoBox {
            width: 95%; 
            max-width: 700px;
            min-height: 100px; 
            margin: 0 auto; 
            border: 2px solid #72a9db; /*041b31 1f4263*/
            background: #63a0d8; /*ecf2e4 fefefc 63a0d8 */
            color: #ffffff; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(40px, 5vw, 60px);
            font-weight: bold;
        }
        
        #contactBox, #instructionBox {
            width: 90%;
            max-width: 700px;
            min-height: 25px;
            margin: 0px auto;
            border: 2px solid #72a9db;
            background: #63a0d8;
            color: #ffd300;
            padding-left: 20px;
            display: flex;
            align-items: center;
            font-size: clamp(16px, 2vw, 20px);
            font-weight: bold;
        }
        
        #instructionBox {
            color: #f7e19c;
        }

        #indicator, #indicator2 {
            width: 90%;
            max-width: 700px;
            min-height: 70px;
            margin: 15px auto;
            padding: 15px;
            border: 3px solid #fed16a;
            background: #ffffe0;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            align-items: center;
            font-size: clamp(32px, 5vw, 48px);
            font-weight: bold;
        }
        
        #indicator2 {
            background: #fffbef;
            border: 3px solid #ccc;
            min-height: 90px;
            transition: all .4s;
        }
        
        #indicator2.correct {
            background: #B7D7AA !important;
            border-color: #5ba346;
        }
        
        #indicator2.wrong {
            background: #ffcccc !important;
            border-color: #CE6D5E;
        }

        .word-btn {
            padding: 10px 20px;
            background: #fff;
            border: 2px solid #63a0d8;
            border-radius: 12px;
            font-size: clamp(32px, 5vw, 48px);
            cursor: pointer;
            user-select: none;
            box-shadow: 0 3px 6px rgba(0,0,0,.15);
            transition: all .2s;
            min-width: 60px;
            text-align: center;
        }
        
        .word-btn.used {
            opacity: 0.35;
            pointer-events: none;
        }
        
        .word-btn-in-answer {
            background: #ffd700 !important;
            animation: pop .3s;
        }
        
        @keyframes pop {
            0% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }

        #optionsPool {
            width: 95%;
            max-width: 700px;
            margin: 20px auto;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        #controls {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 95%;
            max-width: 800px;
            background: #f7fbf3;
            padding: 10px 0;
            z-index: 1000;
        }
        
        button {
            padding: 8px 12px;
            margin: 2px 3px;
            cursor: pointer;
            border: 2px solid #63a0d8;
            background: #63a0d8;
            color: #fffbef;
            font-size: 28px;
            border-radius: 5px;
        }
        
        .active-mode {
            border: 2px solid #fed16a;
        }
        
        .disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        #results, #score {
            width: 95%;
            max-width: 700px;
            margin: 20px auto;
            padding: 15px;
            border-radius: 10px;
            font-size: 28px;
            display: none;
        }
        
        #results {
            border: 2px solid #734A2E;
            background: #fffbef;
        }
        
        #score {
            color: #FF6820;
            background: #fffbef;
            border: 2px solid #FF6820;
        }
                #sentenceNumber {
                        width: 70px;
                        height: 30px;
                        text-align: center;
                        font-size: 20px;
                        border: 2px solid #63a0d8;
                        border-radius: 5px;
                        margin: 0 5px;
                }
        @media (max-width: 768px) {
            body {
                padding-bottom: 220px;
            }
            
            button {
                font-size: 20px;
            }
            
            .word-btn {
                font-size: 28px;
                padding: 8px 14px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBox">习得越南语<br>语法 - 排序练习</div>
        <div id="contactBox">讲师-阮玉煌 | Weixin：XiDeYueNanYu</div>
        <div id="instructionBox">把词语按正确顺序排列 </div>

        <div id="indicator"></div>
        <div id="indicator2"></div>
        <div id="optionsPool"></div>

        <div id="results"></div>
        <div id="score">0/0</div>
    </div>

    <div id="controls">
        <div>
            <button id="freeModeBtn" class="active-mode">自由模式</button>
            <button id="testModeBtn">作业模式</button>
        </div>
        <div>
            <button id="autoContinueBtn">自动继续</button>
            <button id="showHideBtn">显示-隐藏</button>
        </div>
        <div>
            <button id="prevBtn">◀</button>
            <input type="text" id="sentenceNumber" inputmode="numeric">
            <button id="nextBtn">▶</button>
            <button id="replayBtn">再听一遍</button>
        </div>
    </div>

    <audio id="mainAudio"></audio>
    <audio id="correctAudio" src="Dung.mp3"></audio>
    <audio id="wrongAudio" src="Sai.mp3"></audio>

    <script>

const sentences = [
    {
        "audioFile": "audio.mp3",
        "start": 0.441542,
        "end": 1.561542,
        "correctAnswer": "【Lan】【ơi】 !",
        "translation": "(阿)兰！",
        "options": [
            "Lan ơi !",
            "Lăn ơi !",
            "Nan ơi !",
            "Len ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 2.011542,
        "end": 3.031542,
        "correctAnswer": "【Anh】【ơi】 !",
        "translation": "哥哥！",
        "options": [
            "Ănh ơi !",
            "Anh ơi !",
            "Oanh ơi !",
            "Ênh ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 3.501542,
        "end": 4.871542,
        "correctAnswer": "【Chị】【Hoa】【ơi】 !",
        "translation": "(阿)花姐姐！",
        "options": [
            "Chị Hoa ơi !",
            "Chị Hòa ơi !",
            "Dị Hoa ơi !",
            "Chị Hôa ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 5.301542,
        "end": 6.351542,
        "correctAnswer": "【Ông】【ơi】 !",
        "translation": "爷爷！",
        "options": [
            "Ôn ơi !",
            "Ông ơi !",
            "Ôm ơi !",
            "Âng ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 6.751542,
        "end": 8.071542,
        "correctAnswer": "【Bà】【Mai】【ơi】 !",
        "translation": "(阿)梅奶奶！",
        "options": [
            "Bà Mai ơi !",
            "Bà Mái ơi !",
            "Bà Mơi ơi !",
            "Mà Mai ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 8.661542,
        "end": 9.731542,
        "correctAnswer": "【Bạn】【ơi】 !",
        "translation": "朋友！",
        "options": [
            "Bạn ơi !",
            "Bạn ới !",
            "Vạn ơi !",
            "Bạt ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 10.251542,
        "end": 11.391542,
        "correctAnswer": "【Thầy】【ơi】 !",
        "translation": "老师！",
        "options": [
            "Thầy ơi !",
            "Thấy ơi !",
            "Thây ơi !",
            "Dầy ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 11.911542,
        "end": 13.271542,
        "correctAnswer": "【Cô】【Nga】【ơi】 !",
        "translation": "(阿)娥老师！",
        "options": [
            "Cô Nga ơi !",
            "Cô Nha ơi !",
            "Cô Ngà ơi !",
            "Gô Nga ơi !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 13.731542,
        "end": 16.621542,
        "correctAnswer": "【Đây】【là】【cái】【bút】, 【cái】【bút】【này】【tốt】.",
        "translation": "这是笔，这支笔很好。",
        "options": [
            "Đây là cái bút, cái bút này tốt.",
            "Đây là cái bụt, cái bụt này tốt.",
            "Đây là cái bút, cái bút này tót.",
            "Đây là cái vút, cái bút này tốt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 16.991542,
        "end": 20.151542,
        "correctAnswer": "【Đây】【là】【bức】【tranh】, 【bức】【tranh】【này】【xấu】.",
        "translation": "这是画，这幅画不好看。",
        "options": [
            "Đây là bức chanh, bức chanh này xấu.",
            "Đây là bức tranh, bức tranh này xấu.",
            "Đây là bức tranh, bức tranh này xẩu.",
            "Đây là bước tranh, bức tranh này xấu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 20.551542,
        "end": 23.841542,
        "correctAnswer": "【Đấy】【là】【con】【gà】, 【con】【gà】【ấy】【béo】.",
        "translation": "那是只鸡，那只鸡很胖。",
        "options": [
            "Đấy là con gà, con gà ấy béo.",
            "Đấy là con cá, con gà ấy béo.",
            "Đấy là con gà, con gà ấy bếu.",
            "Đấy là con gà, con gá ấy béo."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 24.481542,
        "end": 27.631542,
        "correctAnswer": "【Kia】【là】【con】【trâu】, 【con】【trâu】【ấy】【gầy】.",
        "translation": "那是头水牛，那头水牛很瘦。",
        "options": [
            "Kia là con trơu, con trâu ấy gầy.",
            "Kia là con trơu, con trâu ấy gẫy.",
            "Kia là con trâu, con trâu ấy gầy.",
            "Kia là con châu, con trâu ấy gầy."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 28.291542,
        "end": 31.481542,
        "correctAnswer": "【Đó】【là】【quyển】【từ】【điển】, 【quyển】【từ】【điển】【đó】【đắt】.",
        "translation": "那是词典，那本词典很贵。",
        "options": [
            "Đó là quyển từ điển, quyển từ điển đó đắt.",
            "Đó là quyển từ điển, quyển từ điển đó dát.",
            "Đó là quyển từ điển, quyển tờ điển đó đắt.",
            "Đó là quyền từ điển, quyển từ điển đó đắt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 31.971542,
        "end": 35.011542,
        "correctAnswer": "【Đây】【là】【đôi】【giày】, 【đôi】【giày】【này】【rẻ】.",
        "translation": "这是双鞋，这双鞋很便宜。",
        "options": [
            "Đây là đôi giày, đôi giày này rẻ.",
            "Đây là đôi giày, đôi giày này rễ.",
            "Đây là đôi gày, đôi giày này rẻ.",
            "Đây là đơi giày, đôi giày này rẻ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 35.621542,
        "end": 38.661542,
        "correctAnswer": "【Đấy】【là】【quả】【vải】, 【quả】【vải】【ấy】【ngon】.",
        "translation": "那是荔枝，那荔枝很好吃。",
        "options": [
            "Đấy là quả vải, quả vải ấy ngon.",
            "Đấy là quả vài, quả vải ấy ngon.",
            "Đấy là quả vải, quả vải ấy ngôn.",
            "Đấy là quả phai, quả vải ấy ngon."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 39.191542,
        "end": 42.141542,
        "correctAnswer": "【Kia】【là】【bông】【hoa】, 【bông】【hoa】【ấy】【đẹp】.",
        "translation": "那是朵花，那朵花很漂亮。",
        "options": [
            "Kia là bông hoa, bông hoa ấy đẹp.",
            "Kia là bông khoa, bông hoa ấy đẹp.",
            "Kia là bông hoa, bông hoa ấy đep.",
            "Kia là bóng hoa, bông hoa ấy đẹp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 42.621542,
        "end": 45.441542,
        "correctAnswer": "【Đó】【là】【cái】【kính】, 【cái】【kính】【ấy】【xấu】.",
        "translation": "那是眼镜，那副眼镜不好看。",
        "options": [
            "Đó là cái kính, cái kính ấy xấu.",
            "Đó là cái kính, cái kính ấy xẩu.",
            "Đó là cái kình, cái kính ấy xấu.",
            "Đó là cái khính, cái kính ấy xấu."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 45.981542,
        "end": 48.901542,
        "correctAnswer": "Đ【ây】【là】【quyển】【sách】, 【quyển】【sách】【này】【mỏng】.",
        "translation": "这是书，这本书很薄。",
        "options": [
            "Đây là quyển sách, quyển sách này mỏng.",
            "Đây là quyền sách, quyển sách này mỏng.",
            "Đây là quyển sách, quyển sách này mỗng.",
            "Đây là quyển sách, quyển sách này mõng."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 49.511542,
        "end": 52.461542,
        "correctAnswer": "【Đấy】【là】【cuốn】【lịch】, 【cuốn】【lịch】【đó】【dày】.",
        "translation": "那是日历，那本日历很厚。",
        "options": [
            "Đấy là cuốn lịch, cuốn lịch đó dày.",
            "Đấy là cuốn địch, cuốn lịch đó dày.",
            "Đấy là cuốn lịch, cuốn lịch đó dáy.",
            "Đấy là cuốn lịch, cuốn lịch đó dại."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 53.021542,
        "end": 56.241542,
        "correctAnswer": "【Kia】【là】【bài】【toán】, 【bài】【toán】【ấy】【khó】.",
        "translation": "那是道数学题，那道题很难。",
        "options": [
            "Kia là bài toán, bài toán ấy khó.",
            "Kia là bài toán, bài toán ấy khô.",
            "Kia là bài toàn, bài toán ấy khó.",
            "Kia là bày toán, bài toán ấy khó."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 56.711542,
        "end": 59.601542,
        "correctAnswer": "【Đó】【là】【bài】【toán】, 【bài】【toán】【ấy】【dễ】.",
        "translation": "那是道数学题，那道题很简单。",
        "options": [
            "Đó là bài toán, bài toán ấy dễ.",
            "Đó là bại toán, bài toán ấy dễ.",
            "Đó là bài toán, bài toán ấy dể.",
            "Đó là bài toan, bài toán ấy dễ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 60.281542,
        "end": 63.101542,
        "correctAnswer": "【Đây】【là】【cái】【mũ】, 【cái】【mũ】【này】【mới】.",
        "translation": "这是帽子，这顶帽子是新的。",
        "options": [
            "Đây là cái mũ, cái mũ này mới.",
            "Đây là cái mũ, cái mũ này muối.",
            "Đây là cái mủ, cái mũ này mới.",
            "Đây là cái mũ, cái mũ này mơi."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 63.571542,
        "end": 66.551542,
        "correctAnswer": "【Đấy】【là】【cái】【ghế】, 【cái】【ghế】【đó】【cũ】.",
        "translation": "那是椅子，那张椅子是旧的。",
        "options": [
            "Đấy là cái ghế, cái ghế đó cũ.",
            "Đấy là cái ghế, cái ghế đó củ.",
            "Đấy là cái ghể, cái ghế đó cũ.",
            "Đấy là cái kế, cái ghế đó cũ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 67.151542,
        "end": 70.181542,
        "correctAnswer": "【Kia】【là】【con】【chuột】, 【con】【chuột】【ấy】【nhỏ】.",
        "translation": "那是老鼠，那只老鼠很小。",
        "options": [
            "Kia là con chuột, con chuột ấy nhỏ.",
            "Kia là con chuột, con chuột ấy nhõ.",
            "Kia là con chột, con chuột ấy nhỏ.",
            "Kia là con chuột, con suột ấy nhỏ."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 70.791542,
        "end": 73.841542,
        "correctAnswer": "【Đó】【là】【con】【voi】, 【con】【voi】【ấy】【to】.",
        "translation": "那是大象，那头大象很大。",
        "options": [
            "Đó là con voi, con voi ấy to.",
            "Đó là con voi, con voi ấy tô.",
            "Đó là con voi, con soi ấy to.",
            "Đó là con vôi, con voi ấy to."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 74.341542,
        "end": 75.981542,
        "correctAnswer": "【Ngôi】【nhà】【ấy】【thế】【nào】?",
        "translation": "那栋房子怎么样？",
        "options": [
            "Ngôi nhà ấy thế nào?",
            "Ngôi nhá ấy thế nào?",
            "Ngôi nhà ấy thề nào?",
            "Ngôi nhà ấy thê nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 76.461542,
        "end": 77.791542,
        "correctAnswer": "【Ngôi】【nhà】【ấy】【đẹp】.",
        "translation": "那栋房子很漂亮。",
        "options": [
            "Ngôi nhà ấy đẹp.",
            "Ngôi nhà ấy đep.",
            "Ngôi nha ấy đẹp.",
            "Ngôi nhà ấy dẹp."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 78.411542,
        "end": 80.191542,
        "correctAnswer": "【Chiếc】【xe】【máy】【ấy】【thế】【nào】?",
        "translation": "那辆摩托车怎么样？",
        "options": [
            "Chiếc xe máy ấy thế nào?",
            "Chiếc xe mải ấy thế nào?",
            "Chiếc se máy ấy thế nào?",
            "Chiếc xe máy ấy thề nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 80.641542,
        "end": 82.181542,
        "correctAnswer": "【Chiếc】【xe】【máy】【ấy】【tốt】.",
        "translation": "那辆摩托车很好。",
        "options": [
            "Chiếc xe máy ấy tốt.",
            "Chiếc xe máy ấy tót.",
            "Chiếc xe mấy ấy tốt.",
            "Chiếc che máy ấy tốt."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 82.721542,
        "end": 84.941542,
        "correctAnswer": "【Cái】【đồng】【hồ】【đeo】【tay】【đó】【thế】【nào】?",
        "translation": "那块手表怎么样？",
        "options": [
            "Cái đồng hồ đeo tay đó thế nào?",
            "Cái đồng hồ đeo tay đó thê nào?",
            "Cái đồng hồ đeo tai đó thế nào?",
            "Cái đồng hồ đeo tay đó tể nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 85.311542,
        "end": 87.131542,
        "correctAnswer": "【Cái】【đồng】【hồ】【đeo】【tay】【đó】【đắt】.",
        "translation": "那块手表很贵。",
        "options": [
            "Cái đồng hồ đeo tay đó đắt.",
            "Cái đồng hồ đeo tay đó dát.",
            "Cái đồng hồ đeo tai đó đắt.",
            "Cái đồng hồ đeo tay đó đát."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 87.821542,
        "end": 89.621542,
        "correctAnswer": "【Quả】【chuối】【ấy】【có】【ngon】【không】?",
        "translation": "那根香蕉好吃吗？",
        "options": [
            "Quả chuối ấy có ngon không?",
            "Quả chuối ấy cố ngon không?",
            "Quả chuối ấy có ngôn không?",
            "Quả chối ấy có ngon không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 90.031542,
        "end": 91.471542,
        "correctAnswer": "【Quả】【chuối】【ấy】【ngon】.",
        "translation": "那根香蕉很好吃。",
        "options": [
            "Quả chuối ấy ngon.",
            "Quả chuối ấy ngọn.",
            "Quả chươi ấy ngon.",
            "Quả chuối ấy gon."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 91.991542,
        "end": 93.841542,
        "correctAnswer": "【Quả】【dứa】【ấy】【có】【chua】【không】.",
        "translation": "那个菠萝酸吗？",
        "options": [
            "Quả dứa ấy có chua không.",
            "Quả dứa ấy có chụa không.",
            "Quả dứa ấy có sua không.",
            "Quả dứa ấy cố chua không."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 94.321542,
        "end": 95.791542,
        "correctAnswer": "【Quả】【dứa】【ấy】【chua】.",
        "translation": "那个菠萝很酸。",
        "options": [
            "Quả dứa ấy chua.",
            "Quả dứa ấy chúa.",
            "Quả dứa ấy sua.",
            "Quả lứa ấy chua."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 96.271542,
        "end": 97.981542,
        "correctAnswer": "【Quả】【dứa】【ấy】【không】【chua】.",
        "translation": "那个菠萝不酸。",
        "options": [
            "Quả dứa ấy không chua.",
            "Quả dứa ấy khong chua.",
            "Quả đứa ấy không chua.",
            "Quả dứa ấy không chuô."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 98.431542,
        "end": 100.081542,
        "correctAnswer": "【Quả】【dứa】【ấy】【chua】【lắm】.",
        "translation": "那个菠萝非常酸。",
        "options": [
            "Quả dứa ấy chua lắm.",
            "Quả dứa ấy chua lám.",
            "Quả dứa ấy chua lẳm.",
            "Quả dứa ấy chua lãm."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 100.671542,
        "end": 102.631542,
        "correctAnswer": "【Quả】【dứa】【ấy】【không】【chua】【lắm】.",
        "translation": "那个菠萝不太酸。",
        "options": [
            "Quả dứa ấy không chua lắm.",
            "Quả dứa ấy khong chua lắm.",
            "Quả dứa ấy không chua lẳm.",
            "Quả đứa ấy không chua lắm."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 103.221542,
        "end": 105.001542,
        "correctAnswer": "【Quả】【dứa】【ấy】【rất】【chua】.",
        "translation": "那个菠萝很酸。",
        "options": [
            "Quả dứa ấy rất chua.",
            "Quả dứa ấy rát chua.",
            "Quả dứa ấy rất chuô.",
            "Quả dứa ấy rớt chua."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 105.331542,
        "end": 106.291542,
        "correctAnswer": "【Chua】【quá】 !",
        "translation": "太酸了！",
        "options": [
            "Chua quá !",
            "Chưa quá !",
            "Chua quả !",
            "Chụa quá !"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 106.821542,
        "end": 108.651542,
        "correctAnswer": "【Quả】【dưa】【hấu】【này】【thế】【nào】?",
        "translation": "这个西瓜怎么样？",
        "options": [
            "Quả dưa hấu này thế nào?",
            "Quả dưa hấu này thê nào?",
            "Quả dưa hấu này thể nào?",
            "Quả dưa háu này thế nào?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 109.041542,
        "end": 111.091542,
        "correctAnswer": "【Quả】【dưa】【hấu】【này】【có】【ngon】【không】?",
        "translation": "这个西瓜好吃吗？",
        "options": [
            "Quả dưa hấu này có ngon không?",
            "Quả dưa hấu này có ngôn không?",
            "Quả dưa hấu này có ngon khong?",
            "Quả dưa hấu này cố ngon không?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 111.471542,
        "end": 112.531542,
        "correctAnswer": "【thế】【nào】?",
        "translation": "怎么样？",
        "options": [
            "thế nào?",
            "thê nào?",
            "thể nào?",
            "thế nào"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 113.001542,
        "end": 114.101542,
        "correctAnswer": "【ngon】【không】?",
        "translation": "好吃吗？",
        "options": [
            "ngon không?",
            "ngon khong?",
            "ngôn không?",
            "ngon khống?"
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 116.531542,
        "end": 117.641542,
        "correctAnswer": "【rất】【ngon】.",
        "translation": "非常好吃。",
        "options": [
            "rất ngon.",
            "rát ngon.",
            "rấc ngon.",
            "rất ngôn."
        ]
    },
    {
        "audioFile": "audio.mp3",
        "start": 118.031542,
        "end": 119,
        "correctAnswer": "【ngon】【lắm】.",
        "translation": "好吃极了。",
        "options": [
            "ngon lắm.",
            "ngôn lắm.",
            "ngon lám.",
            "ngon lãm."
        ]
    }
];

        let currentIndex = 0;
        let isFreeMode = true;
        let autoContinue = false;
        let showTranslation = true;
        let correctCount = 0;
        let userAnswers = [];
        let selectedWords = [];
        let isChecking = false;
        let isAudioPlaying = false;

        const audio = document.getElementById('mainAudio');
        const correctAudio = document.getElementById('correctAudio');
        const wrongAudio = document.getElementById('wrongAudio');
        const indicator = document.getElementById('indicator');
        const indicator2 = document.getElementById('indicator2');
        const optionsPool = document.getElementById('optionsPool');
        const sentenceNumber = document.getElementById('sentenceNumber');
        const scoreDisplay = document.getElementById('score');
        const resultsDisplay = document.getElementById('results');

        function init() {
            userAnswers = new Array(sentences.length).fill(null);
            updateDisplay();
        }

        function updateDisplay() {
            sentenceNumber.value = currentIndex + 1;
            const s = sentences[currentIndex];
            
            if (showTranslation) {
                indicator.innerHTML = `<div style="color:#63a0d8;font-size:0.6em;">${s.translation}</div>`;
            } else {
                indicator.innerHTML = '';
            }

            const words = s.correctAnswer.match(/【(.*?)】/g).map(t => t.slice(1,-1));
            const shuffled = shuffleArray(words);

            optionsPool.innerHTML = '';
            indicator2.innerHTML = '';
            indicator2.className = '';
            selectedWords = [];
            isChecking = false;

            shuffled.forEach(word => {
                const btn = document.createElement('div');
                btn.className = 'word-btn';
                btn.textContent = word;
                btn.onclick = () => selectWord(word, btn);
                optionsPool.appendChild(btn);
            });

            document.getElementById('prevBtn').classList.toggle('disabled', !isFreeMode && currentIndex === 0);
        }

        function selectWord(word, btn) {
            if (btn.classList.contains('used')) {
                const idx = selectedWords.indexOf(word);
                if (idx > -1) {
                    selectedWords.splice(idx, 1);
                    btn.classList.remove('used');
                    renderAnswerArea();
                }
                return;
            }

            selectedWords.push(word);
            btn.classList.add('used');
            renderAnswerArea();

            indicator2.classList.remove('correct', 'wrong');
            
            if (selectedWords.length === getCorrectWords().length && !isChecking) {
                isChecking = true;
                setTimeout(checkAnswer, 400);
            }
        }

        function renderAnswerArea() {
            indicator2.innerHTML = '';
            selectedWords.forEach((word, i) => {
                const btn = document.createElement('div');
                btn.className = 'word-btn word-btn-in-answer';
                btn.textContent = word;
                btn.onclick = () => {
                    selectedWords.splice(i, 1);
                    renderAnswerArea();
                    Array.from(optionsPool.children).find(b => b.textContent === word)?.classList.remove('used');
                    isChecking = false;
                    indicator2.classList.remove('correct', 'wrong');
                };
                indicator2.appendChild(btn);
            });
        }

        function getCorrectWords() {
            return sentences[currentIndex].correctAnswer.match(/【(.*?)】/g).map(t => t.slice(1,-1));
        }

        function getCorrectAnswerWithSpaces() {
            const words = getCorrectWords();
            return words.join(' ');
        }

        function checkAnswer() {
            const userStr = selectedWords.join('');
            const correctStr = getCorrectWords().join('');
            const isCorrect = userStr === correctStr;

            if (!isFreeMode && userAnswers[currentIndex] === null) {
                userAnswers[currentIndex] = selectedWords.join(' ');
                if (isCorrect) correctCount++;
                updateScore();
            }

            if (isCorrect) {
                indicator2.classList.add('correct');
                indicator2.classList.remove('wrong');
                correctAudio.play();
                playOriginalSentenceExactly();
            } else {
                indicator2.classList.add('wrong');
                wrongAudio.play();
                
                // Trong chế độ 作业模式, phát âm thanh ngay cả khi sai
                if (!isFreeMode) {
                    playOriginalSentenceExactly();
                }
            }

            const delay = 1200;
            
            const moveToNextSentence = () => {
                if (isFreeMode) {
                    if (autoContinue && isCorrect) {
                        nextSentence();
                    }
                } else {
                    if (currentIndex < sentences.length - 1) {
                        currentIndex++;
                        updateDisplay();
                    } else {
                        showFinalResults();
                    }
                }
            };
            
            setTimeout(() => {
                if (!isAudioPlaying) {
                    moveToNextSentence();
                } else {
                    const checkAudioEnd = setInterval(() => {
                        if (!isAudioPlaying) {
                            clearInterval(checkAudioEnd);
                            moveToNextSentence();
                        }
                    }, 100);
                }
            }, delay);
        }

        function playOriginalSentenceExactly() {
            const s = sentences[currentIndex];
            audio.src = s.audioFile;
            audio.currentTime = s.start;
            isAudioPlaying = true;
            audio.play();

            const stopAtEnd = () => {
                if (audio.currentTime >= s.end) {
                    audio.pause();
                    isAudioPlaying = false;
                    audio.removeEventListener('timeupdate', stopAtEnd);
                }
            };
            audio.addEventListener('timeupdate', stopAtEnd);
            
            audio.addEventListener('ended', () => {
                isAudioPlaying = false;
            });
        }

        document.getElementById('replayBtn').onclick = playOriginalSentenceExactly;

        function showFinalResults() {
            let text = `练习完成！\n正确：${correctCount}/${sentences.length}（${(correctCount/sentences.length*100).toFixed(1)}%）\n\n`;
            
            let hasWrong = false;
            let wrongQuestionsText = "错题回顾：\n";
            
            for (let i = 0; i < sentences.length; i++) {
                const correctWords = getCorrectWordsFromSentence(sentences[i]);
                const correctAnswerWithSpaces = correctWords.join(' ');
                
                if (userAnswers[i] && userAnswers[i] !== correctAnswerWithSpaces) {
                    hasWrong = true;
                    wrongQuestionsText += `${i+1}. ${sentences[i].translation}\n   你的答案: ${userAnswers[i]}\n   正确答案: ${correctAnswerWithSpaces}\n\n`;
                }
            }
            
            if (hasWrong) {
                text += wrongQuestionsText;
            } else {
                text += "全对！太厉害了！";
            }
            
            resultsDisplay.textContent = text;
            resultsDisplay.style.display = 'block';
            scoreDisplay.style.display = 'none';
        }

        function getCorrectWordsFromSentence(sentence) {
            return sentence.correctAnswer.match(/【(.*?)】/g).map(t => t.slice(1,-1));
        }

        function updateScore() {
            scoreDisplay.textContent = `${correctCount}/${sentences.length}`;
        }

        function nextSentence() {
            if (currentIndex < sentences.length - 1) {
                currentIndex++;
                updateDisplay();
            } else if (isFreeMode) {
                currentIndex = 0;
                updateDisplay();
            }
        }

        function prevSentence() {
            if (currentIndex > 0) {
                currentIndex--;
                updateDisplay();
            } else if (isFreeMode) {
                currentIndex = sentences.length - 1;
                updateDisplay();
            }
        }

        function shuffleArray(a) {
            const arr = [...a];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        document.getElementById('freeModeBtn').onclick = () => {
            isFreeMode = true;
            document.getElementById('freeModeBtn').classList.add('active-mode');
            document.getElementById('testModeBtn').classList.remove('active-mode');
            scoreDisplay.style.display = 'none';
            resultsDisplay.style.display = 'none';
            updateDisplay();
        };

        document.getElementById('testModeBtn').onclick = () => {
            isFreeMode = false;
            document.getElementById('testModeBtn').classList.add('active-mode');
            document.getElementById('freeModeBtn').classList.remove('active-mode');
            scoreDisplay.style.display = 'block';
            resultsDisplay.style.display = 'none';
            currentIndex = 0;
            correctCount = 0;
            userAnswers = new Array(sentences.length).fill(null);
            updateDisplay();
        };

        document.getElementById('prevBtn').onclick = () => {
            if (isFreeMode) {
                prevSentence();
            } else if (currentIndex > 0) {
                currentIndex--;
                updateDisplay();
            }
        };
        
        document.getElementById('nextBtn').onclick = () => {
            if (isFreeMode) {
                nextSentence();
            } else if (currentIndex < sentences.length - 1) {
                currentIndex++;
                updateDisplay();
            }
        };

        document.getElementById('autoContinueBtn').onclick = () => {
            autoContinue = !autoContinue;
            document.getElementById('autoContinueBtn').classList.toggle('active-mode', autoContinue);
        };

        document.getElementById('showHideBtn').onclick = () => {
            showTranslation = !showTranslation;
            document.getElementById('showHideBtn').classList.toggle('active-mode', showTranslation);
            updateDisplay();
        };

        sentenceNumber.onchange = () => {
            if (isFreeMode) {
                const n = parseInt(sentenceNumber.value) - 1;
                if (n >= 0 && n < sentences.length) { 
                    currentIndex = n; 
                    updateDisplay(); 
                }
            }
        };

        init();
    </script>
</body>
</html>